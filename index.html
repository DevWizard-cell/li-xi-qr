<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>L√¨ X√¨ 2027</title>

<style>
*{margin:0;padding:0;box-sizing:border-box;}

body{
font-family:-apple-system,BlinkMacSystemFont,sans-serif;
background:radial-gradient(circle at top,#ff2a2a,#8b0000);
color:white;
min-height:100vh;
overflow:auto;
}

/* SCREEN */
.screen{
position:fixed;
inset:0;
display:flex;
flex-direction:column;
justify-content:center;
align-items:center;
text-align:center;
padding:20px;
}

input{
padding:12px;
border-radius:20px;
border:none;
width:80%;
max-width:300px;
margin-top:15px;
text-align:center;
font-size:16px;
}

button{
padding:10px 20px;
border:none;
border-radius:20px;
margin:10px;
font-weight:bold;
cursor:pointer;
}

.primary{background:gold;color:black;}
.secondary{background:white;color:black;}
.hidden{display:none}

/* GRID */
.grid{
display:grid;
grid-template-columns:repeat(3,1fr);
gap:14px;
padding:20px;
max-width:500px;
margin:auto;
max-height:75vh;
overflow-y:auto;
}

.item{text-align:center;}

.lixi{
width:100%;
border-radius:16px;
cursor:pointer;
transition:0.3s;
box-shadow:0 4px 10px rgba(0,0,0,0.4);
}
.lixi:hover{transform:scale(1.08);}

.percent{
font-size:13px;
margin-top:6px;
opacity:0.9;
}

/* OVERLAY */
.overlay{
position:fixed;
inset:0;
background:rgba(0,0,0,0.75);
display:flex;
justify-content:center;
align-items:center;
flex-direction:column;
visibility:hidden;
opacity:0;
transition:0.4s;
}

.overlay.show{
visibility:visible;
opacity:1;
}

.preview{
background:rgba(255,255,255,0.1);
padding:25px;
border-radius:25px;
text-align:center;
max-width:320px;
backdrop-filter:blur(10px);
}

.preview img{
width:180px;
border-radius:15px;
margin-bottom:12px;
}

.notice{
margin-top:10px;
font-size:14px;
opacity:0.85;
}

/* FIREWORK */
canvas{
position:fixed;
top:0;
left:0;
pointer-events:none;
}
</style>
</head>
<body>

<!-- NH·∫¨P T√äN -->
<div class="screen" id="nameScreen">
<h2>üéâ Nh·∫≠p t√™n c·ªßa b·∫°n</h2>
<input id="username" placeholder="Nh·∫≠p t√™n t·∫°i ƒë√¢y">
<button class="primary" onclick="start()">B·∫Øt ƒë·∫ßu</button>
</div>

<!-- CH·ªåN L√å X√å -->
<div id="chooseScreen" class="hidden">
<h3 style="text-align:center;margin-top:15px;">üßß Ch·ªçn m·ªôt l√¨ x√¨ b·∫°n th√≠ch</h3>
<div class="grid" id="grid"></div>
</div>

<!-- PREVIEW -->
<div class="overlay" id="overlay" onclick="closeOverlay(event)">
<div class="preview" onclick="event.stopPropagation()">
<img id="previewImg">
<h3 id="themeTitle"></h3>
<p id="finalWish"></p>
<div id="actionArea"></div>
</div>
</div>

<canvas id="firework"></canvas>

<script>

/* ===== NH·∫†C ===== */
const bgMusic=new Audio("music/tet.mp3");
bgMusic.loop=true;
bgMusic.volume=0;
let musicOn=false;
let fadeInterval=null;

const musicBtn=document.createElement("button");
musicBtn.innerHTML="üîä";
musicBtn.style.position="fixed";
musicBtn.style.top="15px";
musicBtn.style.right="15px";
musicBtn.style.zIndex="9999";
musicBtn.style.borderRadius="50%";
musicBtn.style.width="45px";
musicBtn.style.height="45px";
musicBtn.style.border="none";
musicBtn.style.fontSize="18px";
musicBtn.style.cursor="pointer";
musicBtn.style.background="gold";
musicBtn.style.color="black";
document.body.appendChild(musicBtn);

musicBtn.onclick=toggleMusic;

function toggleMusic(){
if(!musicOn){
bgMusic.play();
fadeInMusic();
musicBtn.innerHTML="üîá";
musicOn=true;
}else{
bgMusic.pause();
musicBtn.innerHTML="üîä";
musicOn=false;
}
}

function fadeInMusic(){
bgMusic.volume=0;
let step=0;
clearInterval(fadeInterval);
fadeInterval=setInterval(()=>{
step+=0.05;
if(step>=1){
bgMusic.volume=1;
clearInterval(fadeInterval);
}else{
bgMusic.volume=step;
}
},100);
}

document.addEventListener("visibilitychange",()=>{
if(document.hidden){
bgMusic.pause();
}else{
if(musicOn) bgMusic.play();
}
});

/* ===== DATA ===== */
const images=[
"images/Phong Bao L√¨ X√¨ ·∫¢nh 1 ƒê·ªè Nay.png",
"images/Phong Bao L√¨ X√¨ ·∫¢nh 2 Cam H·ªìng Nay Nay.png",
"images/Phong Bao L√¨ X√¨ ·∫¢nh 3 Xanh Bi·ªÉn ƒê·∫≠m.png",
"images/Phong Bao L√¨ X√¨ ·∫¢nh 4 ƒê·ªè X∆∞a.png",
"images/Phong Bao L√¨ X√¨ ·∫¢nh 5 V√†ng X∆∞a.png",
"images/Phong Bao L√¨ X√¨ ·∫¢nh 6 Lam X∆∞a.png",
"images/Phong Bao L√¨ X√¨ ·∫¢nh 7 T·∫øt R·ªôn R√†ng.png",
"images/Phong Bao L√¨ X√¨ ·∫¢nh 8 Gen Z.png",
"images/Phong Bao L√¨ X√¨ ·∫¢nh 9 Th∆∞ Ph√°p.png"
];

const themes=[
"üí∞ Ch·ªß ƒë·ªÅ T√†i L·ªôc","üî• Ch·ªß ƒë·ªÅ B·ª©t Ph√°","üåä Ch·ªß ƒë·ªÅ Th√†nh C√¥ng",
"üèÆ Ch·ªß ƒë·ªÅ Truy·ªÅn Th·ªëng","‚ú® Ch·ªß ƒë·ªÅ V√†ng Son","üß† Ch·ªß ƒë·ªÅ N·ªôi L·ª±c",
"üéä Ch·ªß ƒë·ªÅ R·ªôn R√†ng","üöÄ Ch·ªß ƒë·ªÅ Gen Z","üìú Ch·ªß ƒë·ªÅ Th∆∞ Ph√°p"
];

const wishes=[
["2027 b·∫°n s·∫Ω b·ª©t ph√° m·ªçi gi·ªõi h·∫°n!","T√™n b·∫°n s·∫Ω t·ªèa s√°ng!"],
["Ti·ªÅn v√†o nh∆∞ n∆∞·ªõc!","T√†i l·ªôc song h√†nh!"],
["Kh√°m ph√° th√†nh c√¥ng m·ªõi!","ƒêi xa h∆°n b·∫°n nghƒ©!"],
["Gi·ªØ g·ªëc ‚Äì v∆∞∆°n cao!","V·ªØng v√†ng th√†nh c√¥ng!"],
["R·ª±c r·ª° nh∆∞ √°nh v√†ng!","Th·ªãnh v∆∞·ª£ng c·∫£ nƒÉm!"],
["B·∫£n lƒ©nh v·ªØng v√†ng!","S·ª©c m·∫°nh n·ªôi t√¢m l·ªõn d·∫ßn!"],
["Ni·ªÅm vui lan t·ªèa!","T·∫øt ƒë·∫ßy nƒÉng l∆∞·ª£ng!"],
["D·∫´n ƒë·∫ßu xu h∆∞·ªõng!","Kh√°c bi·ªát t·∫°o th√†nh c√¥ng!"],
["Ph√∫c ‚Äì L·ªôc ‚Äì Th·ªç h·ªôi t·ª•!","An khang tr·ªçn nƒÉm!"]
];

let counts=JSON.parse(localStorage.getItem("lixiCounts"))||Array(9).fill(0);
let selectedIndex=null;
let userName="";
let claimed=false;

/* START */
function start(){
const name=document.getElementById("username").value.trim();
if(!name) return alert("Vui l√≤ng nh·∫≠p t√™n");
userName=name;
document.getElementById("nameScreen").classList.add("hidden");
document.getElementById("chooseScreen").classList.remove("hidden");
renderGrid();
}

/* GRID */
function renderGrid(){
const grid=document.getElementById("grid");
grid.innerHTML="";
let total=counts.reduce((a,b)=>a+b,0);

images.forEach((src,index)=>{
const div=document.createElement("div");
div.className="item";

const img=document.createElement("img");
img.src=src;
img.className="lixi";
img.onclick=()=>preview(index);

const percent=document.createElement("div");
percent.className="percent";
let p=total?((counts[index]/total)*100).toFixed(1):0;
percent.innerText=p+"% ch·ªçn";

div.appendChild(img);
div.appendChild(percent);
grid.appendChild(div);
});
}

/* PREVIEW */
function preview(index){
selectedIndex=index;
document.getElementById("overlay").classList.add("show");
document.getElementById("previewImg").src=images[index];
document.getElementById("themeTitle").innerText=themes[index];
document.getElementById("finalWish").innerText="";

if(claimed){
document.getElementById("actionArea").innerHTML=
`<div class="notice">B·∫°n ƒë√£ nh·∫≠n l√¨ x√¨ r·ªìi</div>`;
}else{
document.getElementById("actionArea").innerHTML=
`<button class="primary" onclick="keepLixi()">Gi·ªØ l√¨ x√¨</button>
<button class="secondary" onclick="changeLixi()">ƒê·ªïi l√¨ x√¨</button>`;
}
}

/* GI·ªÆ */
function keepLixi(){
if(claimed) return;

const wish=wishes[selectedIndex][Math.floor(Math.random()*2)];
document.getElementById("finalWish").innerText=userName+", "+wish;

counts[selectedIndex]++;
localStorage.setItem("lixiCounts",JSON.stringify(counts));

claimed=true;
document.getElementById("actionArea").innerHTML=
`<div class="notice">B·∫°n ƒë√£ nh·∫≠n l√¨ x√¨ r·ªìi</div>`;

launchFirework();
renderGrid();
}

/* ƒê·ªîI */
function changeLixi(){
document.getElementById("overlay").classList.remove("show");
}

/* CLOSE */
function closeOverlay(e){
if(e.target.id==="overlay"){
document.getElementById("overlay").classList.remove("show");
}
}

/* FIREWORK */
const canvas=document.getElementById("firework");
const ctx=canvas.getContext("2d");
canvas.width=window.innerWidth;
canvas.height=window.innerHeight;

function launchFirework(){

if(musicOn){
bgMusic.volume=0.3;
setTimeout(()=>{bgMusic.volume=1;},1500);
}

let particles=[];
for(let i=0;i<100;i++){
particles.push({
x:Math.random()*canvas.width,
y:canvas.height,
angle:-Math.PI/2+(Math.random()-0.5),
speed:Math.random()*6+3,
life:60
});
}

function animate(){
ctx.clearRect(0,0,canvas.width,canvas.height);
particles.forEach(p=>{
p.x+=Math.cos(p.angle)*p.speed;
p.y+=Math.sin(p.angle)*p.speed;
p.life--;
ctx.fillStyle="hsl("+Math.random()*360+",100%,60%)";
ctx.beginPath();
ctx.arc(p.x,p.y,3,0,Math.PI*2);
ctx.fill();
});
particles=particles.filter(p=>p.life>0);
if(particles.length>0){
requestAnimationFrame(animate);
}else{
ctx.clearRect(0,0,canvas.width,canvas.height);
}
}
animate();
}

</script>
</body>
</html>
